(()=>{"use strict";let e,t,r;var s=(e,t,r)=>(s,n)=>{let a=-1;return i(0);async function i(o){let l,h;if(o<=a)throw Error("next() called multiple times");a=o;let c=!1;if(e[o]?(h=e[o][0][0],s.req.routeIndex=o):h=o===e.length&&n||void 0,h)try{l=await h(s,()=>i(o+1))}catch(e){if(e instanceof Error&&t)s.error=e,l=await t(e,s),c=!0;else throw e}else!1===s.finalized&&r&&(l=await r(s));return l&&(!1===s.finalized||c)&&(s.res=l),s}},n=Symbol(),a=async(e,t=Object.create(null))=>{let{all:r=!1,dot:s=!1}=t,n=(e instanceof R?e.raw.headers:e.headers).get("Content-Type");return n?.startsWith("multipart/form-data")||n?.startsWith("application/x-www-form-urlencoded")?i(e,{all:r,dot:s}):{}};async function i(e,t){var r,s;let n,a=await e.formData();return a?(r=a,s=t,n=Object.create(null),r.forEach((e,t)=>{s.all||t.endsWith("[]")?o(n,t,e):n[t]=e}),s.dot&&Object.entries(n).forEach(([e,t])=>{e.includes(".")&&(l(n,e,t),delete n[e])}),n):{}}var o=(e,t,r)=>{void 0!==e[t]?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},l=(e,t,r)=>{let s=e,n=t.split(".");n.forEach((e,t)=>{t===n.length-1?s[e]=r:((!s[e]||"object"!=typeof s[e]||Array.isArray(s[e])||s[e]instanceof File)&&(s[e]=Object.create(null)),s=s[e])})},h=e=>{let t=e.split("/");return""===t[0]&&t.shift(),t},c={},d=(e,t)=>{if("*"===e)return"*";let r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){let s=`${e}#${t}`;return c[s]||(r[2]?c[s]=t&&":"!==t[0]&&"*"!==t[0]?[s,r[1],RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],RegExp(`^${r[2]}$`)]:c[s]=[e,r[1],!0]),c[s]}return null},u=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,e=>{try{return t(e)}catch{return e}})}},p=e=>u(e,decodeURI),f=e=>{let t=e.url,r=t.indexOf("/",t.indexOf(":")+4),s=r;for(;s<t.length;s++){let e=t.charCodeAt(s);if(37===e){let e=t.indexOf("?",s),n=t.slice(r,-1===e?void 0:e);return p(n.includes("%25")?n.replace(/%25/g,"%2525"):n)}if(63===e)break}return t.slice(r,s)},m=e=>{let t=f(e);return t.length>1&&"/"===t.at(-1)?t.slice(0,-1):t},g=(e,t,...r)=>(r.length&&(t=g(t,...r)),`${e?.[0]==="/"?"":"/"}${e}${"/"===t?"":`${e?.at(-1)==="/"?"":"/"}${t?.[0]==="/"?t.slice(1):t}`}`),x=e=>{if(63!==e.charCodeAt(e.length-1)||!e.includes(":"))return null;let t=e.split("/"),r=[],s="";return t.forEach(e=>{if(""===e||/\:/.test(e)){if(/\:/.test(e))if(/\?/.test(e)){0===r.length&&""===s?r.push("/"):r.push(s);let t=e.replace("?","");s+="/"+t,r.push(s)}else s+="/"+e}else s+="/"+e}),r.filter((e,t,r)=>r.indexOf(e)===t)},w=e=>/[%+]/.test(e)?(-1!==e.indexOf("+")&&(e=e.replace(/\+/g," ")),-1!==e.indexOf("%")?u(e,y):e):e,b=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let r=e.indexOf(`?${t}`,8);for(-1===r&&(r=e.indexOf(`&${t}`,8));-1!==r;){let s=e.charCodeAt(r+t.length+1);if(61===s){let s=r+t.length+2,n=e.indexOf("&",s);return w(e.slice(s,-1===n?void 0:n))}if(38==s||isNaN(s))return"";r=e.indexOf(`&${t}`,r+1)}if(!(s=/[%+]/.test(e)))return}let n={};s??=/[%+]/.test(e);let a=e.indexOf("?",8);for(;-1!==a;){let t,i=e.indexOf("&",a+1),o=e.indexOf("=",a);o>i&&-1!==i&&(o=-1);let l=e.slice(a+1,-1===o?-1===i?void 0:i:o);s&&(l=w(l)),a=i,""!==l&&(-1===o?t="":(t=e.slice(o+1,-1===i?void 0:i),s&&(t=w(t))),r?(n[l]&&Array.isArray(n[l])||(n[l]=[]),n[l].push(t)):n[l]??=t)}return t?n[t]:n},y=decodeURIComponent,v=e=>u(e,y),R=class{raw;#e;#t;routeIndex=0;path;bodyCache={};constructor(e,t="/",r=[[]]){this.raw=e,this.path=t,this.#t=r,this.#e={}}param(e){return e?this.#r(e):this.#s()}#r(e){let t=this.#t[0][this.routeIndex][1][e],r=this.#n(t);return r&&/\%/.test(r)?v(r):r}#s(){let e={};for(let t of Object.keys(this.#t[0][this.routeIndex][1])){let r=this.#n(this.#t[0][this.routeIndex][1][t]);void 0!==r&&(e[t]=/\%/.test(r)?v(r):r)}return e}#n(e){return this.#t[1]?this.#t[1][e]:e}query(e){return b(this.url,e)}queries(e){return b(this.url,e,!0)}header(e){if(e)return this.raw.headers.get(e)??void 0;let t={};return this.raw.headers.forEach((e,r)=>{t[r]=e}),t}async parseBody(e){return this.bodyCache.parsedBody??=await a(this,e)}#a=e=>{let{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;let n=Object.keys(t)[0];return n?t[n].then(t=>("json"===n&&(t=JSON.stringify(t)),new Response(t)[e]())):t[e]=r[e]()};json(){return this.#a("text").then(e=>JSON.parse(e))}text(){return this.#a("text")}arrayBuffer(){return this.#a("arrayBuffer")}blob(){return this.#a("blob")}formData(){return this.#a("formData")}addValidatedData(e,t){this.#e[e]=t}valid(e){return this.#e[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[n](){return this.#t}get matchedRoutes(){return this.#t[0].map(([[,e]])=>e)}get routePath(){return this.#t[0].map(([[,e]])=>e)[this.routeIndex].path}},j=async(e,t,r,s,n)=>{var a;let i;"object"==typeof e&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));let o=e.callbacks;if(!o?.length)return Promise.resolve(e);n?n[0]+=e:n=[e];let l=Promise.all(o.map(e=>e({phase:t,buffer:n,context:s}))).then(e=>Promise.all(e.filter(Boolean).map(e=>j(e,t,!1,s,n))).then(()=>n[0]));if(!r)return l;return a=await l,(i=new String(a)).isEscaped=!0,i.callbacks=o,i},O=(e,t)=>({"Content-Type":e,...t}),E=class{#i;#o;env={};#l;finalized=!1;error;#h;#c;#d;#u;#p;#f;#m;#t;#g;constructor(e,t){this.#i=e,t&&(this.#c=t.executionCtx,this.env=t.env,this.#f=t.notFoundHandler,this.#g=t.path,this.#t=t.matchResult)}get req(){return this.#o??=new R(this.#i,this.#g,this.#t),this.#o}get event(){if(this.#c&&"respondWith"in this.#c)return this.#c;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#c)return this.#c;throw Error("This context has no ExecutionContext")}get res(){return this.#d||=new Response(null,{headers:this.#m??=new Headers})}set res(e){if(this.#d&&e){for(let[t,r]of(e=new Response(e.body,e),this.#d.headers.entries()))if("content-type"!==t)if("set-cookie"===t){let t=this.#d.headers.getSetCookie();for(let r of(e.headers.delete("set-cookie"),t))e.headers.append("set-cookie",r)}else e.headers.set(t,r)}this.#d=e,this.finalized=!0}render=(...e)=>(this.#p??=e=>this.html(e),this.#p(...e));setLayout=e=>this.#u=e;getLayout=()=>this.#u;setRenderer=e=>{this.#p=e};header=(e,t,r)=>{this.finalized&&(this.#d=new Response(this.#d.body,this.#d));let s=this.#d?this.#d.headers:this.#m??=new Headers;void 0===t?s.delete(e):r?.append?s.append(e,t):s.set(e,t)};status=e=>{this.#h=e};set=(e,t)=>{this.#l??=new Map,this.#l.set(e,t)};get=e=>this.#l?this.#l.get(e):void 0;get var(){return this.#l?Object.fromEntries(this.#l):{}}#x(e,t,r){let s=this.#d?new Headers(this.#d.headers):this.#m??new Headers;if("object"==typeof t&&"headers"in t)for(let[e,r]of t.headers instanceof Headers?t.headers:new Headers(t.headers))"set-cookie"===e.toLowerCase()?s.append(e,r):s.set(e,r);if(r)for(let[e,t]of Object.entries(r))if("string"==typeof t)s.set(e,t);else for(let r of(s.delete(e),t))s.append(e,r);return new Response(e,{status:"number"==typeof t?t:t?.status??this.#h,headers:s})}newResponse=(...e)=>this.#x(...e);body=(e,t,r)=>this.#x(e,t,r);text=(e,t,r)=>this.#m||this.#h||t||r||this.finalized?this.#x(e,t,O("text/plain; charset=UTF-8",r)):new Response(e);json=(e,t,r)=>this.#x(JSON.stringify(e),t,O("application/json",r));html=(e,t,r)=>{let s=e=>this.#x(e,t,O("text/html; charset=UTF-8",r));return"object"==typeof e?j(e,1,!1,{}).then(s):s(e)};redirect=(e,t)=>{let r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)};notFound=()=>(this.#f??=()=>new Response,this.#f(this))},L=["get","post","put","delete","options","patch"],H="Can not add a route since the matcher is already built.",$=class extends Error{},A=e=>e.text("404 Not Found",404),k=(e,t)=>{if("getResponse"in e){let r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},S=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#g="/";routes=[];constructor(e={}){[...L,"all"].forEach(e=>{this[e]=(t,...r)=>("string"==typeof t?this.#g=t:this.#w(e,this.#g,t),r.forEach(t=>{this.#w(e,this.#g,t)}),this)}),this.on=(e,t,...r)=>{for(let s of[t].flat())for(let t of(this.#g=s,[e].flat()))r.map(e=>{this.#w(t.toUpperCase(),this.#g,e)});return this},this.use=(e,...t)=>("string"==typeof e?this.#g=e:(this.#g="*",t.unshift(e)),t.forEach(e=>{this.#w("ALL",this.#g,e)}),this);const{strict:t,...r}=e;Object.assign(this,r),this.getPath=t??!0?e.getPath??f:m}#b(){let e=new S({router:this.router,getPath:this.getPath});return e.errorHandler=this.errorHandler,e.#f=this.#f,e.routes=this.routes,e}#f=A;errorHandler=k;route(e,t){let r=this.basePath(e);return t.routes.map(e=>{let n;t.errorHandler===k?n=e.handler:(n=async(r,n)=>(await s([],t.errorHandler)(r,()=>e.handler(r,n))).res).__COMPOSED_HANDLER=e.handler,r.#w(e.method,e.path,n)}),this}basePath(e){let t=this.#b();return t._basePath=g(this._basePath,e),t}onError=e=>(this.errorHandler=e,this);notFound=e=>(this.#f=e,this);mount(e,t,r){let s,n,a,i;r&&("function"==typeof r?n=r:(n=r.optionHandler,s=!1===r.replaceRequest?e=>e:r.replaceRequest));let o=n?e=>{let t=n(e);return Array.isArray(t)?t:[t]}:e=>{let t;try{t=e.executionCtx}catch{}return[e.env,t]};s||=(i="/"===(a=g(this._basePath,e))?0:a.length,e=>{let t=new URL(e.url);return t.pathname=t.pathname.slice(i)||"/",new Request(t,e)});let l=async(e,r)=>{let n=await t(s(e.req.raw),...o(e));if(n)return n;await r()};return this.#w("ALL",g(e,"*"),l),this}#w(e,t,r){e=e.toUpperCase(),t=g(this._basePath,t);let s={basePath:this._basePath,path:t,method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)}#y(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e}#v(e,t,r,n){if("HEAD"===n)return(async()=>new Response(null,await this.#v(e,t,r,"GET")))();let a=this.getPath(e,{env:r}),i=this.router.match(n,a),o=new E(e,{path:a,matchResult:i,env:r,executionCtx:t,notFoundHandler:this.#f});if(1===i[0].length){let e;try{e=i[0][0][0][0](o,async()=>{o.res=await this.#f(o)})}catch(e){return this.#y(e,o)}return e instanceof Promise?e.then(e=>e||(o.finalized?o.res:this.#f(o))).catch(e=>this.#y(e,o)):e??this.#f(o)}let l=s(i[0],this.errorHandler,this.#f);return(async()=>{try{let e=await l(o);if(!e.finalized)throw Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return e.res}catch(e){return this.#y(e,o)}})()}fetch=(e,...t)=>this.#v(e,t[1],t[0],e.method);request=(e,t,r,s)=>e instanceof Request?this.fetch(t?new Request(e,t):e,r,s):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${g("/",e)}`,t),r,s));fire=()=>{addEventListener("fetch",e=>{e.respondWith(this.#v(e.request,e,void 0,e.request.method))})}},P="[^/]+",F="(?:|/.*)",C=Symbol(),q=new Set(".\\+*[^]$()");function D(e,t){return 1===e.length?1===t.length?e<t?-1:1:-1:1===t.length||".*"===e||e===F?1:".*"===t||t===F?-1:e===P?1:t===P?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var z=class{#R;#j;#O=Object.create(null);insert(e,t,r,s,n){let a;if(0===e.length){if(void 0!==this.#R)throw C;if(n)return;this.#R=t;return}let[i,...o]=e,l="*"===i?0===o.length?["","",".*"]:["","",P]:"/*"===i?["","",F]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(l){let e=l[1],t=l[2]||P;if(e&&l[2]&&(".*"===t||(t=t.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(t))))throw C;if(!(a=this.#O[t])){if(Object.keys(this.#O).some(e=>".*"!==e&&e!==F))throw C;if(n)return;a=this.#O[t]=new z,""!==e&&(a.#j=s.varIndex++)}n||""===e||r.push([e,a.#j])}else if(!(a=this.#O[i])){if(Object.keys(this.#O).some(e=>e.length>1&&".*"!==e&&e!==F))throw C;if(n)return;a=this.#O[i]=new z}a.insert(o,t,r,s,n)}buildRegExpStr(){let e=Object.keys(this.#O).sort(D).map(e=>{let t=this.#O[e];return("number"==typeof t.#j?`(${e})@${t.#j}`:q.has(e)?`\\${e}`:e)+t.buildRegExpStr()});return("number"==typeof this.#R&&e.unshift(`#${this.#R}`),0===e.length)?"":1===e.length?e[0]:"(?:"+e.join("|")+")"}},I=class{#E={varIndex:0};#L=new z;insert(e,t,r){let s=[],n=[];for(let t=0;;){let r=!1;if(e=e.replace(/\{[^}]+\}/g,e=>{let s=`@\\${t}`;return n[t]=[s,e],t++,r=!0,s}),!r)break}let a=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let e=n.length-1;e>=0;e--){let[t]=n[e];for(let r=a.length-1;r>=0;r--)if(-1!==a[r].indexOf(t)){a[r]=a[r].replace(t,n[e][1]);break}}return this.#L.insert(a,t,s,this.#E,r),s}buildRegExp(){let e=this.#L.buildRegExpStr();if(""===e)return[/^$/,[],[]];let t=0,r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(e,n,a)=>void 0!==n?(r[++t]=Number(n),"$()"):(void 0!==a&&(s[Number(a)]=++t),"")),[RegExp(`^${e}`),r,s]}},N=[],B=[/^$/,[],Object.create(null)],U=Object.create(null);function T(e){return U[e]??=new RegExp("*"===e?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,t)=>t?`\\${t}`:"(?:|/.*)")}$`)}function W(e,t){if(e){for(let r of Object.keys(e).sort((e,t)=>t.length-e.length))if(T(r).test(t))return[...e[r]]}}var _=class{name="RegExpRouter";#H;#$;constructor(){this.#H={ALL:Object.create(null)},this.#$={ALL:Object.create(null)}}add(e,t,r){let s=this.#H,n=this.#$;if(!s||!n)throw Error(H);s[e]||[s,n].forEach(t=>{t[e]=Object.create(null),Object.keys(t.ALL).forEach(r=>{t[e][r]=[...t.ALL[r]]})}),"/*"===t&&(t="*");let a=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){let i=T(t);"ALL"===e?Object.keys(s).forEach(e=>{s[e][t]||=W(s[e],t)||W(s.ALL,t)||[]}):s[e][t]||=W(s[e],t)||W(s.ALL,t)||[],Object.keys(s).forEach(t=>{("ALL"===e||e===t)&&Object.keys(s[t]).forEach(e=>{i.test(e)&&s[t][e].push([r,a])})}),Object.keys(n).forEach(t=>{("ALL"===e||e===t)&&Object.keys(n[t]).forEach(e=>i.test(e)&&n[t][e].push([r,a]))});return}let i=x(t)||[t];for(let t=0,o=i.length;t<o;t++){let l=i[t];Object.keys(n).forEach(i=>{("ALL"===e||e===i)&&(n[i][l]||=[...W(s[i],l)||W(s.ALL,l)||[]],n[i][l].push([r,a-o+t+1]))})}}match(e,t){U=Object.create(null);let r=this.#A();return this.match=(e,t)=>{let s=r[e]||r.ALL,n=s[2][t];if(n)return n;let a=t.match(s[0]);if(!a)return[[],N];let i=a.indexOf("",1);return[s[1][i],a]},this.match(e,t)}#A(){let e=Object.create(null);return Object.keys(this.#$).concat(Object.keys(this.#H)).forEach(t=>{e[t]||=this.#k(t)}),this.#H=this.#$=void 0,e}#k(e){let t=[],r="ALL"===e;return([this.#H,this.#$].forEach(s=>{let n=s[e]?Object.keys(s[e]).map(t=>[t,s[e][t]]):[];0!==n.length?(r||=!0,t.push(...n)):"ALL"!==e&&t.push(...Object.keys(s.ALL).map(e=>[e,s.ALL[e]]))}),r)?function(e){let t=new I,r=[];if(0===e.length)return B;let s=e.map(e=>[!/\*|\/:/.test(e[0]),...e]).sort(([e,t],[r,s])=>e?1:r?-1:t.length-s.length),n=Object.create(null);for(let e=0,a=-1,i=s.length;e<i;e++){let i,[o,l,h]=s[e];o?n[l]=[h.map(([e])=>[e,Object.create(null)]),N]:a++;try{i=t.insert(l,a,o)}catch(e){throw e===C?new $(l):e}o||(r[a]=h.map(([e,t])=>{let r=Object.create(null);for(t-=1;t>=0;t--){let[e,s]=i[t];r[e]=s}return[e,r]}))}let[a,i,o]=t.buildRegExp();for(let e=0,t=r.length;e<t;e++)for(let t=0,s=r[e].length;t<s;t++){let s=r[e][t]?.[1];if(!s)continue;let n=Object.keys(s);for(let e=0,t=n.length;e<t;e++)s[n[e]]=o[s[n[e]]]}let l=[];for(let e in i)l[e]=r[i[e]];return[a,l,n]}(t):null}},M=class{name="SmartRouter";#S=[];#$=[];constructor(e){this.#S=e.routers}add(e,t,r){if(!this.#$)throw Error(H);this.#$.push([e,t,r])}match(e,t){let r;if(!this.#$)throw Error("Fatal error");let s=this.#S,n=this.#$,a=s.length,i=0;for(;i<a;i++){let a=s[i];try{for(let e=0,t=n.length;e<t;e++)a.add(...n[e]);r=a.match(e,t)}catch(e){if(e instanceof $)continue;throw e}this.match=a.match.bind(a),this.#S=[a],this.#$=void 0;break}if(i===a)throw Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,r}get activeRouter(){if(this.#$||1!==this.#S.length)throw Error("No active router has been determined yet.");return this.#S[0]}},V=Object.create(null),K=class{#P;#O;#F;#C=0;#q=V;constructor(e,t,r){if(this.#O=r||Object.create(null),this.#P=[],e&&t){const r=Object.create(null);r[e]={handler:t,possibleKeys:[],score:0},this.#P=[r]}this.#F=[]}insert(e,t,r){this.#C=++this.#C;let s=this,n=(e=>{var t;let r,{groups:s,path:n}=(r=[],t=(t=e).replace(/\{[^}]+\}/g,(e,t)=>{let s=`@${t}`;return r.push([s,e]),s}),{groups:r,path:t});return((e,t)=>{for(let r=t.length-1;r>=0;r--){let[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e})(h(n),s)})(t),a=[];for(let e=0,t=n.length;e<t;e++){let t=n[e],r=d(t,n[e+1]),i=Array.isArray(r)?r[0]:t;if(i in s.#O){s=s.#O[i],r&&a.push(r[1]);continue}s.#O[i]=new K,r&&(s.#F.push(r),a.push(r[1])),s=s.#O[i]}return s.#P.push({[e]:{handler:r,possibleKeys:a.filter((e,t,r)=>r.indexOf(e)===t),score:this.#C}}),s}#D(e,t,r,s){let n=[];for(let a=0,i=e.#P.length;a<i;a++){let i=e.#P[a],o=i[t]||i.ALL,l={};if(void 0!==o&&(o.params=Object.create(null),n.push(o),r!==V||s&&s!==V))for(let e=0,t=o.possibleKeys.length;e<t;e++){let t=o.possibleKeys[e],n=l[o.score];o.params[t]=s?.[t]&&!n?s[t]:r[t]??s?.[t],l[o.score]=!0}}return n}search(e,t){let r=[];this.#q=V;let s=[this],n=h(t),a=[];for(let t=0,i=n.length;t<i;t++){let o=n[t],l=t===i-1,h=[];for(let i=0,c=s.length;i<c;i++){let c=s[i],d=c.#O[o];d&&(d.#q=c.#q,l?(d.#O["*"]&&r.push(...this.#D(d.#O["*"],e,c.#q)),r.push(...this.#D(d,e,c.#q))):h.push(d));for(let s=0,i=c.#F.length;s<i;s++){let i=c.#F[s],d=c.#q===V?{}:{...c.#q};if("*"===i){let t=c.#O["*"];t&&(r.push(...this.#D(t,e,c.#q)),t.#q=d,h.push(t));continue}let[u,p,f]=i;if(!o&&!(f instanceof RegExp))continue;let m=c.#O[u],g=n.slice(t).join("/");if(f instanceof RegExp){let t=f.exec(g);if(t){if(d[p]=t[0],r.push(...this.#D(m,e,c.#q,d)),Object.keys(m.#O).length){m.#q=d;let e=t[0].match(/\//)?.length??0;(a[e]||=[]).push(m)}continue}}(!0===f||f.test(o))&&(d[p]=o,l?(r.push(...this.#D(m,e,d,c.#q)),m.#O["*"]&&r.push(...this.#D(m.#O["*"],e,d,c.#q))):(m.#q=d,h.push(m)))}}s=h.concat(a.shift()??[])}return r.length>1&&r.sort((e,t)=>e.score-t.score),[r.map(({handler:e,params:t})=>[e,t])]}},J=class{name="TrieRouter";#z;constructor(){this.#z=new K}add(e,t,r){let s=x(t);if(s){for(let t=0,n=s.length;t<n;t++)this.#z.insert(e,s[t],r);return}this.#z.insert(e,t,r)}match(e,t){return this.#z.search(e,t)}},G=class extends S{constructor(e={}){super(e),this.router=e.router??new M({routers:[new _,new J]})}};let Z=require("node:path");var Q=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,X=(e,t=Y)=>{let r=e.match(/\.([a-zA-Z0-9]+?)$/);if(!r)return;let s=t[r[1]];return s&&s.startsWith("text")&&(s+="; charset=utf-8"),s},Y={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},ee=(...e)=>{let t=e.filter(e=>""!==e).join("/"),r=(t=t.replace(/(?<=\/)\/+/g,"")).split("/"),s=[];for(let e of r)".."===e&&s.length>0&&".."!==s.at(-1)?s.pop():"."!==e&&s.push(e);return s.join("/")||"."},et={br:".br",zstd:".zst",gzip:".gz"},er=Object.keys(et),{open:es,lstatSync:en,errors:ea}=Deno;(()=>{try{return new Response("SSG is disabled",{status:404,headers:{"x-hono-disable-ssg":"true"}})}catch{return null}})();var ei=class{#I;constructor(e){this.#I=e,this.raw=e.raw,this.url=e.url?new URL(e.url):null,this.protocol=e.protocol??null}send(e,t){this.#I.send(e,t??{})}raw;binaryType="arraybuffer";get readyState(){return this.#I.readyState}url;protocol;close(e,t){this.#I.close(e,t)}};e=async(e,t,r)=>{if("websocket"!==e.req.header("upgrade"))return;let{response:s,socket:n}=Deno.upgradeWebSocket(e.req.raw,r??{}),a=new ei({close:(e,t)=>n.close(e,t),get protocol(){return n.protocol},raw:n,get readyState(){return n.readyState},url:n.url?new URL(n.url):null,send:e=>n.send(e)});return n.onopen=e=>t.onOpen?.(e,a),n.onmessage=e=>t.onMessage?.(e,a),n.onclose=e=>t.onClose?.(e,a),n.onerror=e=>t.onError?.(e,a),s},(...t)=>{if("function"==typeof t[0]){let[r,s]=t;return async function(t,n){let a=await r(t),i=await e(t,a,s);if(i)return i;await n()}}{let[r,s,n]=t;return(async()=>{let t=await e(r,s,n);if(!t)throw Error("Failed to upgrade WebSocket");return t})()}};let eo=new G,el=["/static","/favicon.svg","/api"];eo.use("*",(t={root:"web",rewriteRequestPath:e=>el.some(t=>e.startsWith(t))?e:"/"},async function(e,r){var s;let n,a,i,o=async e=>{try{if(l(e))return null;return(await es(e)).readable}catch(e){return e instanceof ea.NotFound||console.warn(`${e}`),null}},l=e=>{let t;try{t=en(e).isDirectory}catch{}return t};return(n=(s={...t,getContent:o,join:Z.join,isDir:l}).root??"./",a=s.path,i=s.join??ee,async(e,t)=>{let r;if(e.finalized)return t();if(s.path)r=s.path;else try{if(r=decodeURIComponent(e.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(r))throw Error()}catch{return await s.onNotFound?.(e.req.path,e),t()}let o=i(n,!a&&s.rewriteRequestPath?s.rewriteRequestPath(r):r);s.isDir&&await s.isDir(o)&&(o=i(o,"index.html"));let l=s.getContent,h=await l(o,e);if(h instanceof Response)return e.newResponse(h.body,h);if(h){let t=s.mimes&&X(o,s.mimes)||X(o);if(e.header("Content-Type",t||"application/octet-stream"),s.precompressed&&(!t||Q.test(t))){let t=new Set(e.req.header("Accept-Encoding")?.split(",").map(e=>e.trim()));for(let r of er){if(!t.has(r))continue;let s=await l(o+et[r],e);if(s){h=s,e.header("Content-Encoding",r),e.header("Vary","Accept-Encoding",{append:!0});break}}}return await s.onFound?.(o,e),e.body(h)}await s.onNotFound?.(o,e),await t()})(e,r)})),r=new G,eo.route("/api",r),Deno.serve(eo.fetch),module.exports={}})();